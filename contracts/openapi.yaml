openapi: 3.1.0
info:
  title: BEL IC Verification API
  description: |
    Offline-first API for counterfeit IC detection system.
    
    ## Overview
    This API powers an automated optical inspection (AOI) system that verifies 
    whether Integrated Circuits (ICs) are authentic or counterfeit by comparing 
    their physical appearance against a local "Golden Record" database.
    
    ## Key Features
    - **Offline-First**: Operates without internet, syncs weekly
    - **OCR + Vision**: Reads chip text and counts pins
    - **Self-Healing Database**: Learns new ICs through web scraping
    - **Counterfeit Detection**: Maintains registry of known fakes
    
  version: 2.0.0
  contact:
    name: BEL IC Verification Team

servers:
  - url: http://localhost:8000
    description: Local Development Server

tags:
  - name: Core Inspection
    description: Primary scanning and verification endpoints
  - name: IC Database
    description: Golden Record IC specifications
  - name: Scan History
    description: Audit trail of all scans
  - name: Dashboard
    description: Statistics and analytics
  - name: Datasheet Queue
    description: Pending ICs for online scraping
  - name: Fake Registry
    description: Known counterfeit IC numbers
  - name: Sync Operations
    description: Weekly online sync job management
  - name: Settings
    description: System configuration
  - name: System
    description: Health checks and system status
  - name: Camera
    description: AOI camera feed and capture control

paths:
  # ================================================================
  # CORE INSPECTION ENDPOINTS
  # ================================================================
  /api/v1/scan:
    post:
      tags: [Core Inspection]
      summary: Upload Image for Inspection
      operationId: scanImage
      description: |
        Primary endpoint. Uploads an IC image for verification.
        Performs OCR to read text and Vision to count pins.
        
        Returns one of:
        - **PASS**: IC matches golden record
        - **FAIL**: Pin count mismatch (possible relabeled chip)
        - **PARTIAL**: Need bottom scan (BTC components)
        - **UNKNOWN**: IC not in database (added to sync queue)
        - **COUNTERFEIT**: IC is in fake registry
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
                  description: JPEG/PNG image of the IC
      responses:
        '200':
          description: Inspection completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScanResult'
              examples:
                Pass:
                  summary: IC verified successfully
                  value:
                    scan_id: "550e8400-e29b-41d4-a716-446655440000"
                    status: "PASS"
                    action_required: "NONE"
                    confidence_score: 94.5
                    ocr_text: "LM555CN"
                    part_number: "LM555"
                    manufacturer_detected: "Texas Instruments"
                    detected_pins: 8
                    message: "IC verified successfully. All parameters match."
                    match_details:
                      part_number_match: true
                      pin_count_match: true
                      manufacturer_match: true
                    queued_for_sync: false
                    ic_specification:
                      part_number: "LM555"
                      manufacturer: "Texas Instruments"
                      pin_count: 8
                      package_type: "DIP"
                      description: "Precision Timer IC"
                      datasheet_path: "/datasheets/LM555.pdf"
                      has_datasheet: true
                    scanned_at: "2025-12-01T10:30:00Z"
                NeedBottomScan:
                  summary: Bottom-terminated component needs flip
                  value:
                    scan_id: "550e8400-e29b-41d4-a716-446655440001"
                    status: "PARTIAL"
                    action_required: "SCAN_BOTTOM"
                    confidence_score: 65.0
                    ocr_text: "ATMEGA328P-AU"
                    part_number: "ATMEGA328P"
                    manufacturer_detected: "Microchip"
                    detected_pins: 0
                    message: "Pins not visible. Please flip and scan the bottom."
                    queued_for_sync: false
                    scanned_at: "2025-12-01T10:32:00Z"
                Unknown:
                  summary: IC not in database
                  value:
                    scan_id: "550e8400-e29b-41d4-a716-446655440002"
                    status: "UNKNOWN"
                    action_required: "NONE"
                    confidence_score: 88.0
                    ocr_text: "XYZ9999"
                    part_number: "XYZ9999"
                    detected_pins: 16
                    message: "IC not found in database. Added to sync queue."
                    queued_for_sync: true
                    ic_specification: null
                    scanned_at: "2025-12-01T10:35:00Z"
                Counterfeit:
                  summary: Known fake IC detected
                  value:
                    scan_id: "550e8400-e29b-41d4-a716-446655440003"
                    status: "COUNTERFEIT"
                    action_required: "NONE"
                    confidence_score: 100.0
                    ocr_text: "FAKE123"
                    part_number: "FAKE123"
                    detected_pins: 8
                    message: "ALERT: This IC is in the fake registry."
                    queued_for_sync: false
                    fake_registry_info:
                      added_at: "2025-11-15T08:00:00Z"
                      source: "SYNC_NOT_FOUND"
                      reason: "Not found on any manufacturer website"
                    scanned_at: "2025-12-01T10:40:00Z"
        '400':
          description: Invalid image or request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/scan/{scan_id}/bottom:
    post:
      tags: [Core Inspection]
      summary: Upload Bottom-View Image
      operationId: scanBottomImage
      description: |
        Used when initial scan returns `action_required: SCAN_BOTTOM`.
        For bottom-terminated components (QFN, BGA) where pins are underneath.
      parameters:
        - name: scan_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: The scan_id from the initial top scan
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: Bottom scan processed and merged
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScanResult'
        '404':
          description: Scan ID not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "SCAN_NOT_FOUND"
                message: "No pending scan found with this ID."

  /api/v1/scan/override:
    post:
      tags: [Core Inspection]
      summary: Manual Part Number Correction
      operationId: manualOverride
      description: |
        Used when OCR fails to read the chip correctly.
        Operator types the correct part number manually.
        System still uses vision to verify pin count.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ManualOverrideRequest'
      responses:
        '200':
          description: Override processed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScanResult'
        '404':
          description: Scan ID not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ================================================================
  # IC DATABASE ENDPOINTS
  # ================================================================
  /api/v1/ic/{part_number}/details:
    get:
      tags: [IC Database]
      summary: Get IC Specification
      operationId: getICDetails
      description: Fetch IC details from the Golden Record database.
      parameters:
        - name: part_number
          in: path
          required: true
          schema:
            type: string
          example: "LM555"
      responses:
        '200':
          description: IC found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ICSpecification'
        '404':
          description: IC not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "IC_NOT_FOUND"
                message: "Part number 'XYZ999' not found in database."
                suggestion: "This IC may be in the sync queue or fake registry."

  /api/v1/ic/{part_number}/datasheet:
    get:
      tags: [IC Database]
      summary: Download IC Datasheet PDF
      operationId: getICDatasheet
      description: Stream the locally stored PDF datasheet for an IC.
      parameters:
        - name: part_number
          in: path
          required: true
          schema:
            type: string
          example: "LM555"
      responses:
        '200':
          description: PDF file
          content:
            application/pdf:
              schema:
                type: string
                format: binary
        '404':
          description: Datasheet not available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "DATASHEET_NOT_FOUND"
                message: "Datasheet for 'LM555' not available locally."

  /api/v1/ic/search:
    get:
      tags: [IC Database]
      summary: Search ICs
      operationId: searchICs
      description: Search the IC database by part number or manufacturer.
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
          description: Search query
          example: "555"
        - name: manufacturer
          in: query
          schema:
            type: string
          description: Filter by manufacturer
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ICSearchResult'

  # ================================================================
  # SCAN HISTORY ENDPOINTS
  # ================================================================
  /api/v1/scans/list:
    get:
      tags: [Scan History]
      summary: List All Scans
      operationId: listScans
      description: Paginated list of all scan history with optional filters.
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [PASS, FAIL, PARTIAL, UNKNOWN, COUNTERFEIT]
        - name: date_from
          in: query
          schema:
            type: string
            format: date-time
        - name: date_to
          in: query
          schema:
            type: string
            format: date-time
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
            maximum: 200
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: Scan list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScanListResult'

  /api/v1/scans/{scan_id}/details:
    get:
      tags: [Scan History]
      summary: Get Scan Details
      operationId: getScanDetails
      description: Get full details of a specific scan including IC specification.
      parameters:
        - name: scan_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Scan details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScanDetails'
        '404':
          description: Scan not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ================================================================
  # DASHBOARD ENDPOINTS
  # ================================================================
  /api/v1/dashboard/stats:
    get:
      tags: [Dashboard]
      summary: Get Dashboard Statistics
      operationId: getDashboardStats
      description: Aggregate statistics for the dashboard.
      responses:
        '200':
          description: Statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardStats'

  # ================================================================
  # DATASHEET QUEUE ENDPOINTS
  # ================================================================
  /api/v1/queue/list:
    get:
      tags: [Datasheet Queue]
      summary: List Pending ICs
      operationId: listQueue
      description: List all ICs waiting to be scraped during next sync.
      responses:
        '200':
          description: Queue list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueueListResult'

  /api/v1/queue/{part_number}/remove:
    delete:
      tags: [Datasheet Queue]
      summary: Remove from Queue
      operationId: removeFromQueue
      description: Remove an IC from the sync queue (e.g., if added by mistake).
      parameters:
        - name: part_number
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Removed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          description: Part number not in queue
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ================================================================
  # FAKE REGISTRY ENDPOINTS
  # ================================================================
  /api/v1/fakes/list:
    get:
      tags: [Fake Registry]
      summary: List Known Fakes
      operationId: listFakes
      description: List all IC numbers confirmed as fake/non-existent.
      responses:
        '200':
          description: Fake registry list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FakeListResult'

  /api/v1/fakes/mark:
    post:
      tags: [Fake Registry]
      summary: Mark IC as Fake
      operationId: markAsFake
      description: Manually add an IC number to the fake registry.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MarkFakeRequest'
      responses:
        '200':
          description: Added to fake registry
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FakeRegistryItem'
        '409':
          description: Already in fake registry
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/fakes/{part_number}/unmark:
    delete:
      tags: [Fake Registry]
      summary: Remove from Fake Registry
      operationId: unmarkFake
      description: Remove an IC from the fake registry (if marked by mistake).
      parameters:
        - name: part_number
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Removed from fake registry
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          description: Part number not in fake registry
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ================================================================
  # SYNC OPERATION ENDPOINTS
  # ================================================================
  /api/v1/sync/start:
    post:
      tags: [Sync Operations]
      summary: Start Weekly Sync
      operationId: startSync
      description: |
        Triggers background scraping job for all queued ICs.
        Requires internet connection.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SyncStartRequest'
      responses:
        '202':
          description: Sync job started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SyncJobInfo'
        '409':
          description: Sync already in progress
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "SYNC_IN_PROGRESS"
                message: "A sync job is already running."
                current_job_id: "660e8400-e29b-41d4-a716-446655440099"
                progress_percentage: 45

  /api/v1/sync/status:
    get:
      tags: [Sync Operations]
      summary: Get Sync Progress
      operationId: getSyncStatus
      description: Poll this endpoint to update the sync progress bar.
      responses:
        '200':
          description: Current sync status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SyncStatus'

  /api/v1/sync/cancel:
    post:
      tags: [Sync Operations]
      summary: Cancel Sync Job
      operationId: cancelSync
      description: Stop the currently running sync job.
      responses:
        '200':
          description: Sync cancelled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          description: No sync job running
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/sync/history:
    get:
      tags: [Sync Operations]
      summary: Get Sync History
      operationId: getSyncHistory
      description: List past sync job results.
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: Sync history
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SyncHistoryResult'

  # ================================================================
  # SETTINGS ENDPOINTS
  # ================================================================
  /api/v1/settings/list:
    get:
      tags: [Settings]
      summary: Get All Settings
      operationId: listSettings
      description: Get current system configuration.
      responses:
        '200':
          description: Settings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Settings'

  /api/v1/settings/update:
    patch:
      tags: [Settings]
      summary: Update Settings
      operationId: updateSettings
      description: Update one or more system settings.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SettingsUpdateRequest'
      responses:
        '200':
          description: Settings updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SettingsUpdateResponse'

  # ================================================================
  # SYSTEM ENDPOINTS
  # ================================================================
  /api/v1/health:
    get:
      tags: [System]
      summary: Health Check
      operationId: healthCheck
      description: Basic health check endpoint.
      responses:
        '200':
          description: System healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "healthy"
                  timestamp:
                    type: string
                    format: date-time

  /api/v1/system/status:
    get:
      tags: [System]
      summary: Detailed System Status
      operationId: getSystemStatus
      description: Comprehensive system status including database, camera, network, and storage.
      responses:
        '200':
          description: System status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemStatus'

  # ================================================================
  # CAMERA ENDPOINTS
  # ================================================================
  /api/v1/camera/feed:
    get:
      tags: [Camera]
      summary: WebSocket Video Feed
      operationId: cameraFeed
      description: |
        **WebSocket endpoint** for live video streaming.
        
        Connect: `ws://localhost:8000/api/v1/camera/feed`
        
        - Phone sends: Binary JPEG frames
        - Desktop receives: Binary JPEG frames
        - Server sends JSON events: CAMERA_CONNECTED, CAMERA_DISCONNECTED
      responses:
        '101':
          description: WebSocket upgrade

  /api/v1/camera/capture:
    post:
      tags: [Camera]
      summary: Trigger Frame Capture
      operationId: captureFrame
      description: |
        Desktop triggers capture of current frame from the video feed.
        The captured frame is then processed through the scan pipeline.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CaptureRequest'
      responses:
        '200':
          description: Frame captured, processing started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CaptureResponse'
        '503':
          description: Camera not connected
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "CAMERA_NOT_CONNECTED"
                message: "No camera feed available. Please connect the AOI device."

# ================================================================
# COMPONENTS (SCHEMAS)
# ================================================================
components:
  schemas:
    # --------------------------------------------------
    # CORE SCAN SCHEMAS
    # --------------------------------------------------
    ScanResult:
      type: object
      description: Result of an IC scan operation
      properties:
        scan_id:
          type: string
          format: uuid
          description: Unique identifier for this scan
        status:
          type: string
          enum: [PASS, FAIL, PARTIAL, UNKNOWN, COUNTERFEIT]
          description: |
            - PASS: IC verified authentic
            - FAIL: Mismatch detected (wrong pin count)
            - PARTIAL: Need bottom scan
            - UNKNOWN: Not in database
            - COUNTERFEIT: In fake registry
        action_required:
          type: string
          enum: [NONE, SCAN_BOTTOM]
          description: Next action for the UI
        confidence_score:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: OCR/Vision confidence (0-100)
        ocr_text:
          type: string
          description: Raw text extracted from chip
        part_number:
          type: string
          description: Cleaned/parsed part number
        manufacturer_detected:
          type: string
          nullable: true
          description: Manufacturer if detected from text/logo
        detected_pins:
          type: integer
          description: Number of pins counted by vision
        message:
          type: string
          description: Human-readable result message
        match_details:
          $ref: '#/components/schemas/MatchDetails'
        queued_for_sync:
          type: boolean
          description: True if added to sync queue
        ic_specification:
          $ref: '#/components/schemas/ICSpecification'
        fake_registry_info:
          $ref: '#/components/schemas/FakeRegistryInfo'
        scanned_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
          nullable: true

    MatchDetails:
      type: object
      nullable: true
      properties:
        part_number_match:
          type: boolean
        pin_count_match:
          type: boolean
          nullable: true
        manufacturer_match:
          type: boolean
          nullable: true

    ManualOverrideRequest:
      type: object
      required: [scan_id, manual_part_number]
      properties:
        scan_id:
          type: string
          format: uuid
          description: The scan to override
        manual_part_number:
          type: string
          description: Correct part number typed by operator
          example: "LM555"
        operator_note:
          type: string
          description: Optional note explaining the override

    # --------------------------------------------------
    # IC DATABASE SCHEMAS
    # --------------------------------------------------
    ICSpecification:
      type: object
      nullable: true
      description: Golden Record IC specification
      properties:
        part_number:
          type: string
        manufacturer:
          type: string
        pin_count:
          type: integer
        package_type:
          type: string
          description: DIP, QFN, BGA, SOIC, TSSOP, etc.
        description:
          type: string
        datasheet_url:
          type: string
          description: Original web URL
        datasheet_path:
          type: string
          description: Local file path
        has_datasheet:
          type: boolean
        voltage_min:
          type: number
          format: float
        voltage_max:
          type: number
          format: float
        operating_temp_min:
          type: number
          format: float
        operating_temp_max:
          type: number
          format: float
        electrical_specs:
          type: object
          additionalProperties: true
        source:
          type: string
          enum: [MANUAL, SCRAPED_MOUSER, SCRAPED_DIGIKEY, SCRAPED_ALLDATASHEET]
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ICSearchResult:
      type: object
      properties:
        results:
          type: array
          items:
            type: object
            properties:
              part_number:
                type: string
              manufacturer:
                type: string
              pin_count:
                type: integer
              package_type:
                type: string
              description:
                type: string
        total_count:
          type: integer
        limit:
          type: integer
        offset:
          type: integer

    # --------------------------------------------------
    # SCAN HISTORY SCHEMAS
    # --------------------------------------------------
    ScanListResult:
      type: object
      properties:
        scans:
          type: array
          items:
            type: object
            properties:
              scan_id:
                type: string
                format: uuid
              part_number:
                type: string
              status:
                type: string
                enum: [PASS, FAIL, PARTIAL, UNKNOWN, COUNTERFEIT]
              confidence_score:
                type: number
              detected_pins:
                type: integer
              scanned_at:
                type: string
                format: date-time
        total_count:
          type: integer
        limit:
          type: integer
        offset:
          type: integer

    ScanDetails:
      type: object
      properties:
        scan_id:
          type: string
          format: uuid
        ocr_text_raw:
          type: string
          description: Raw OCR output before cleanup
        part_number_detected:
          type: string
        part_number_verified:
          type: string
        status:
          type: string
          enum: [PASS, FAIL, PARTIAL, UNKNOWN, COUNTERFEIT]
        confidence_score:
          type: number
        detected_pins:
          type: integer
        expected_pins:
          type: integer
          nullable: true
        manufacturer_detected:
          type: string
        action_required:
          type: string
          enum: [NONE, SCAN_BOTTOM]
        has_bottom_scan:
          type: boolean
        was_manual_override:
          type: boolean
        match_details:
          $ref: '#/components/schemas/MatchDetails'
        failure_reasons:
          type: array
          nullable: true
          items:
            type: string
        message:
          type: string
        scanned_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
        ic_specification:
          $ref: '#/components/schemas/ICSpecification'

    # --------------------------------------------------
    # DASHBOARD SCHEMAS
    # --------------------------------------------------
    DashboardStats:
      type: object
      properties:
        total_scans:
          type: integer
        scans_today:
          type: integer
        scans_this_week:
          type: integer
        pass_count:
          type: integer
        fail_count:
          type: integer
        unknown_count:
          type: integer
        counterfeit_count:
          type: integer
        pass_rate_percentage:
          type: number
          format: float
        queue_size:
          type: integer
          description: Pending ICs for sync
        fake_registry_size:
          type: integer
        database_ic_count:
          type: integer
          description: Total ICs in golden record
        last_sync_at:
          type: string
          format: date-time
          nullable: true
        last_sync_status:
          type: string
          enum: [IDLE, PROCESSING, COMPLETED, ERROR, CANCELLED]
          nullable: true
        recent_counterfeits:
          type: array
          items:
            type: object
            properties:
              part_number:
                type: string
              scanned_at:
                type: string
                format: date-time

    # --------------------------------------------------
    # DATASHEET QUEUE SCHEMAS
    # --------------------------------------------------
    QueueListResult:
      type: object
      properties:
        queue_items:
          type: array
          items:
            $ref: '#/components/schemas/QueueItem'
        total_count:
          type: integer
        pending_count:
          type: integer
        failed_count:
          type: integer

    QueueItem:
      type: object
      properties:
        part_number:
          type: string
        first_seen_at:
          type: string
          format: date-time
        last_scanned_at:
          type: string
          format: date-time
        scan_count:
          type: integer
          description: How many times scanned while unknown
        status:
          type: string
          enum: [PENDING, PROCESSING, FAILED]
        retry_count:
          type: integer
        error_message:
          type: string
          nullable: true

    # --------------------------------------------------
    # FAKE REGISTRY SCHEMAS
    # --------------------------------------------------
    FakeListResult:
      type: object
      properties:
        fake_ics:
          type: array
          items:
            $ref: '#/components/schemas/FakeRegistryItem'
        total_count:
          type: integer

    FakeRegistryItem:
      type: object
      properties:
        part_number:
          type: string
        source:
          type: string
          enum: [SYNC_NOT_FOUND, MANUAL_REPORT]
        reason:
          type: string
        reported_by:
          type: string
          nullable: true
        added_at:
          type: string
          format: date-time
        scrape_attempts:
          type: integer
        manufacturers_checked:
          type: array
          items:
            type: string

    FakeRegistryInfo:
      type: object
      nullable: true
      description: Info when IC is in fake registry
      properties:
        added_at:
          type: string
          format: date-time
        source:
          type: string
          enum: [SYNC_NOT_FOUND, MANUAL_REPORT]
        reason:
          type: string

    MarkFakeRequest:
      type: object
      required: [part_number, reason]
      properties:
        part_number:
          type: string
        reason:
          type: string
        reported_by:
          type: string

    # --------------------------------------------------
    # SYNC SCHEMAS
    # --------------------------------------------------
    SyncStartRequest:
      type: object
      properties:
        max_items:
          type: integer
          description: Maximum items to process (optional)
        retry_failed:
          type: boolean
          default: true
          description: Retry previously failed items

    SyncJobInfo:
      type: object
      properties:
        job_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [PROCESSING]
        message:
          type: string
        queue_size:
          type: integer
        estimated_time_minutes:
          type: integer

    SyncStatus:
      type: object
      properties:
        job_id:
          type: string
          format: uuid
          nullable: true
        status:
          type: string
          enum: [IDLE, PROCESSING, COMPLETED, ERROR, CANCELLED]
        progress_percentage:
          type: integer
        current_item:
          type: string
          nullable: true
        total_items:
          type: integer
        processed_items:
          type: integer
        success_count:
          type: integer
        failed_count:
          type: integer
        fake_count:
          type: integer
          description: Items moved to fake registry
        started_at:
          type: string
          format: date-time
          nullable: true
        estimated_completion:
          type: string
          format: date-time
          nullable: true
        message:
          type: string
          nullable: true

    SyncHistoryResult:
      type: object
      properties:
        sync_jobs:
          type: array
          items:
            type: object
            properties:
              job_id:
                type: string
                format: uuid
              status:
                type: string
                enum: [COMPLETED, ERROR, CANCELLED]
              started_at:
                type: string
                format: date-time
              completed_at:
                type: string
                format: date-time
              total_items:
                type: integer
              success_count:
                type: integer
              failed_count:
                type: integer
              fake_count:
                type: integer
        total_count:
          type: integer

    # --------------------------------------------------
    # SETTINGS SCHEMAS
    # --------------------------------------------------
    Settings:
      type: object
      properties:
        settings:
          type: object
          properties:
            datasheet_folder_path:
              type: string
            auto_queue_unknown:
              type: boolean
            ocr_confidence_threshold:
              type: number
              format: float
            scan_history_retention_days:
              type: integer
            enable_auto_cleanup:
              type: boolean
            pin_detection_model:
              type: string
            ocr_model:
              type: string

    SettingsUpdateRequest:
      type: object
      additionalProperties: true
      description: Key-value pairs of settings to update
      example:
        scan_history_retention_days: 180
        ocr_confidence_threshold: 75.0

    SettingsUpdateResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        updated_settings:
          type: object
          additionalProperties: true

    # --------------------------------------------------
    # SYSTEM SCHEMAS
    # --------------------------------------------------
    SystemStatus:
      type: object
      properties:
        status:
          type: string
          enum: [operational, degraded, offline]
        database:
          type: object
          properties:
            connected:
              type: boolean
            ic_count:
              type: integer
        camera:
          type: object
          properties:
            connected:
              type: boolean
            last_frame_at:
              type: string
              format: date-time
              nullable: true
        network:
          type: object
          properties:
            internet_available:
              type: boolean
            last_checked:
              type: string
              format: date-time
        queue:
          type: object
          properties:
            pending_count:
              type: integer
            failed_count:
              type: integer
        storage:
          type: object
          properties:
            datasheet_folder:
              type: string
            datasheet_count:
              type: integer
            folder_size_mb:
              type: number
        last_sync:
          type: object
          nullable: true
          properties:
            job_id:
              type: string
              format: uuid
            status:
              type: string
            completed_at:
              type: string
              format: date-time

    # --------------------------------------------------
    # CAMERA SCHEMAS
    # --------------------------------------------------
    CaptureRequest:
      type: object
      required: [capture_type]
      properties:
        capture_type:
          type: string
          enum: [TOP, BOTTOM]
        scan_id:
          type: string
          format: uuid
          description: Required only for BOTTOM capture

    CaptureResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        scan_id:
          type: string
          format: uuid

    # --------------------------------------------------
    # COMMON SCHEMAS
    # --------------------------------------------------
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string

    Error:
      type: object
      properties:
        error:
          type: string
          description: Error code
        message:
          type: string
          description: Human-readable error message
        suggestion:
          type: string
          nullable: true
        details:
          type: object
          additionalProperties: true
          nullable: true
